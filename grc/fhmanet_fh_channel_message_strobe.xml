<?xml version="1.0"?>
<!--
###################################################
##FH Channel Message Strobe
###################################################
 -->
<block>
	<name>FH Message Strobe</name>
	<key>fh_channel_message_strobe</key>
	<category>gr-fhmanet</category>
	<import>import fhmanet</import>
	<import>from gnuradio import blocks</import>
	<import>import pmt</import>
	<make>fhmanet.fh_channel_message_strobe(
		$period_ms,
		$center_freq, 
		$channel_width, 
		$num_channels, 
		$sequence_length, 
		$tx_security_key)
	</make>
    <callback>set_period($period)</callback>
    <callback>set_center_freq($center_freq)</callback>
    <callback>set_channel_width($channel_width)</callback>
    <callback>set_num_channels($num_channels)</callback>
    <callback>set_sequence_length($sequence_length)</callback>
    <callback>set_tx_security_key($tx_security_key)</callback>
	<!--param>
		<name>Message PMT</name>
		<key>msg</key>
		<value>pmt.intern("TEST")</value>
		<type>raw</type>
	</param-->
	<param>
		<name>Period (ms)</name>
		<key>period_ms</key>
		<value>1000</value>
		<type>real</type>
	</param>
	<param>
		<name>Center Frequency</name>
		<key>center_freq</key>
		<value>1000</value>
		<type>real</type>
	</param>
	<param>
		<name>Channel Width</name>
		<key>channel_width</key>
		<value>50000</value>
		<type>real</type>
	</param>
	<param>
		<name>Number of Channels</name>
		<key>num_channels</key>
		<value>500</value>
		<type>int</type>
	</param>
	<param>
		<name>Sequence Length</name>
		<key>sequence_length</key>
		<value>12800</value>
		<type>int</type>
	</param>
	<param>
		<name>Tx Security Key</name>
		<key>tx_security_key</key>
		<value>12345</value>
		<type>int</type>
	</param>
	<source>
		<name>freq_out</name>
		<type>message</type>
        <optional>1</optional>
	</source>
	<doc>Uses the XORshift PRNG to generate a spread-spectrum hop sequence.
	Checks the clock time to determine what the current hop should be, then
	sends a PMT message pair of the frequency the signal source should 
	generate.
	
	Period: channel dwell time
	Center Frequency: center frequency of the transmission bandwidth
	Channel Width: bandwidth of each sub-channel in Hz
	Number of Channels: number of sub-channels in the tx bandwidth
	Sequence Length: Length of the PRNG sequence before it repeats. Max 
		value is 2^64-1.
	Tx Security Key: TSK is the seed number for the XORshift PRNG. Also 
		serves as the NetID. All radios meant to operate on the same net
		must use the same TSK.
	</doc>	
</block>
